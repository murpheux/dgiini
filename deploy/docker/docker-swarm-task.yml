version: "3.4"
services:

    task_service:
        image: python:3.7.0-stretch
        environment:
            - NODE_ENV=development
        ports:
            - "7001:7001"
        volumes:
            - ../../service:/usr/src/app
        command: >
            bash -c "cd /usr/src/app
            && pip install --upgrade pip
            && pip install -r requirements.txt
            && python ./seed.py
            && gunicorn --certfile=certs/dgiini.crt --keyfile=certs/private.key --workers=2 --bind 0.0.0.0:7001 task_v1:api"
        networks:
            - svcnet
        deploy:
            replicas: 4

    db:
        image: mongo:4.0.0-xenial
        ports:
            - "27017:27017"
        #entrypoint: [ "/usr/bin/mongod", "--bind_ip_all", "--replSet", "mongol" ]
        networks:
            - dbnet
        deploy:
            replicas: 1

networks:
    svcnet:
    dbnet:
